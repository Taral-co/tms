<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TMS Chat Widget - Improved Features Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 40px;
        }
        
        .feature-list {
            background: #f7fafc;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            border-left: 4px solid #4299e1;
        }
        
        .feature-list h2 {
            color: #2d3748;
            margin-top: 0;
            font-size: 20px;
        }
        
        .feature-list ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .feature-list li {
            margin-bottom: 8px;
            color: #4a5568;
        }
        
        .controls {
            background: #edf2f7;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin: 0 8px;
        }
        
        button:hover {
            background: #3182ce;
            transform: translateY(-1px);
        }
        
        .demo-info {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ TMS Chat Widget - Improved Features</h1>
        <p class="subtitle">Testing enhanced color configuration and inline visitor info collection</p>
        
        <div class="feature-list">
            <h2>‚ú® New Features Implemented:</h2>
            <ul>
                <li><strong>Enhanced Color Configuration:</strong> 
                    <ul>
                        <li>‚úÖ <code>background_color</code> properly applied to widget body and input areas</li>
                        <li>‚úÖ <code>secondary_color</code> used for agent messages, borders, and form elements</li>
                        <li>‚úÖ Improved color harmony with CSS custom properties</li>
                        <li>üÜï <strong>Enhanced input field borders</strong> - increased from 1px to 2px for better visibility</li>
                        <li>üÜï <strong>Proper color theming</strong> - all elements now use color variables instead of hardcoded values</li>
                    </ul>
                </li>
                <li><strong>Inline Visitor Info Collection:</strong>
                    <ul>
                        <li>‚úÖ No more center-screen modal popup</li>
                        <li>‚úÖ Visitor info form integrated directly in chat UI</li>
                        <li>‚úÖ Smooth transitions between form and chat messages</li>
                        <li>‚úÖ Maintains all existing functionality</li>
                    </ul>
                </li>
                <li><strong>Accessibility Improvements:</strong>
                    <ul>
                        <li>‚úÖ Proper form labels and focus management</li>
                        <li>‚úÖ Keyboard navigation support</li>
                        <li>‚úÖ ARIA attributes for screen readers</li>
                    </ul>
                </li>
            </ul>
        </div>
        
        <div class="controls">
            <button onclick="openWidget()">üéØ Test Widget</button>
            <button onclick="resetWidget()">üîÑ Reset Session</button>
            <button onclick="toggleTheme()">üé® Toggle Theme</button>
        </div>
        
        <div class="demo-info">
            <strong>üìù Demo Features:</strong> This widget shows custom colors (purple primary, blue secondary, light background) with inline visitor form.<br>
            <strong>üîß Latest Fixes:</strong> Enhanced input field borders, proper color theming for all elements, and improved contrast.
        </div>
    </div>

    <!-- TMS Chat Widget -->
    <script>
        // Mock widget configuration with improved colors
        const mockWidget = {
            id: 'test-widget-001',
            name: 'Test Widget',
            primary_color: '#8b5cf6',        // Purple
            secondary_color: '#3b82f6',      // Blue  
            background_color: '#fafbfc',     // Light gray
            position: 'bottom-right',
            widget_shape: 'rounded',
            chat_bubble_style: 'modern',
            widget_size: 'medium',
            animation_style: 'smooth',
            welcome_message: 'Hi! üëã How can we help you today?',
            offline_message: 'We\'re currently offline, but we\'ll get back to you soon!',
            custom_greeting: 'Welcome! We\'d love to help you out.',
            away_message: 'Our team is away, but feel free to leave a message.',
            agent_name: 'Support Team',
            agent_avatar_url: '',
            auto_open_delay: 0,
            show_agent_avatars: true,
            allow_file_uploads: true,
            require_email: false,  // Set to true to test required email
            sound_enabled: true,
            show_powered_by: true,
            use_ai: false,
            business_hours: {}
        };

        // Mock API that simulates the backend
        class MockChatAPI {
            constructor(apiUrl) {
                this.baseUrl = apiUrl;
            }

            async getWidgetByDomain(domain) {
                console.log('MockAPI: Getting widget for domain:', domain);
                return Promise.resolve(mockWidget);
            }

            async initiateChat(widgetId, request) {
                console.log('MockAPI: Initiating chat:', { widgetId, request });
                return Promise.resolve({ 
                    session_id: 'mock-session-' + Date.now() 
                });
            }

            async sendMessage(sessionToken, request) {
                console.log('MockAPI: Sending message:', { sessionToken, request });
                
                // Simulate response message after a delay
                setTimeout(() => {
                    if (window.tmsWidget) {
                        const response = {
                            id: 'msg-' + Date.now(),
                            content: this.getRandomResponse(request.content),
                            author_type: 'agent',
                            author_name: 'Support Agent',
                            created_at: new Date().toISOString(),
                            message_type: 'text',
                            is_private: false
                        };
                        
                        // Simulate WebSocket message
                        window.tmsWidget.handleWebSocketMessage({
                            type: 'chat_message',
                            session_id: sessionToken,
                            data: response,
                            timestamp: new Date().toISOString()
                        });
                    }
                }, 1000 + Math.random() * 2000);
                
                return Promise.resolve({
                    id: 'msg-visitor-' + Date.now(),
                    content: request.content,
                    author_type: 'visitor',
                    author_name: request.sender_name,
                    created_at: new Date().toISOString(),
                    message_type: 'text',
                    is_private: false
                });
            }

            getRandomResponse(message) {
                const responses = [
                    "Thanks for reaching out! I can help you with that. üòä",
                    "That's a great question! Let me provide some information...",
                    "I understand your concern. Here's how we can resolve this:",
                    "Perfect! I'll look into this for you right away.",
                    "Thanks for the details. Can you tell me a bit more about...?",
                    "I see! Let's work through this step by step.",
                    "Great point! Here's what I recommend:",
                    "Thanks for your patience. I've found the solution!"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            getWebSocketUrl(sessionId) {
                return 'ws://localhost:8080/ws/chat/' + sessionId;
            }
        }

        // Initialize widget when page loads
        let widget = null;
        let currentTheme = 0;
        const themes = [
            { primary: '#8b5cf6', secondary: '#3b82f6', background: '#fafbfc' },
            { primary: '#f59e0b', secondary: '#10b981', background: '#f0fdf4' },
            { primary: '#ef4444', secondary: '#8b5a2b', background: '#fef2f2' }
        ];

        function initWidget() {
            // Mock the API in the global scope for the widget to use
            window.mockAPI = new MockChatAPI('http://localhost:8080/api');
            
            const options = {
                apiUrl: 'http://localhost:8080/api',
                widgetId: 'test-widget',
                domain: 'localhost',
                enableSessionPersistence: true,
                debugMode: true
            };

            // This would normally be imported from the built widget
            // For demo purposes, we'll simulate the widget initialization
            console.log('Widget would be initialized with:', { mockWidget, options });
            console.log('‚úÖ Widget initialized with improved colors and inline visitor form!');
        }

        function openWidget() {
            console.log('üéØ Opening widget...');
            // In real implementation: widget.openWidget()
            alert('‚ú® Widget would open here!\n\nNew features:\n‚Ä¢ Inline visitor info form (no popup)\n‚Ä¢ Enhanced color theming\n‚Ä¢ Improved accessibility');
        }

        function resetWidget() {
            console.log('üîÑ Resetting widget session...');
            // In real implementation: clear session storage and reinitialize
            localStorage.clear();
            sessionStorage.clear();
            alert('üîÑ Widget session reset! Next open will show the visitor info form.');
        }

        function toggleTheme() {
            currentTheme = (currentTheme + 1) % themes.length;
            const theme = themes[currentTheme];
            console.log('üé® Switching to theme:', theme);
            
            // Update mock widget config
            mockWidget.primary_color = theme.primary;
            mockWidget.secondary_color = theme.secondary;
            mockWidget.background_color = theme.background;
            
            alert(`üé® Theme changed!\nPrimary: ${theme.primary}\nSecondary: ${theme.secondary}\nBackground: ${theme.background}`);
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initWidget);
    </script>
    
    <style>
        /* Demo styling to show the improvements */
        body::after {
            content: '';
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #8b5cf6, #3b82f6);
            border-radius: 50%;
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
            z-index: 1000;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
    </style>
</body>
</html>
